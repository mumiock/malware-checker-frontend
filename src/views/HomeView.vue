<template>
  <div class="home-column">
    <h1>Check Malicious Adresses</h1>
    <div class="home-row">
      <div class="row-width card-container">
        <doughnut-chart
          :data="this.doughnutChartData"
          containerClass="custom-chart-container"
          :shadow="false"
        />
      </div>
      <div class="row-width form-container">
        <form-container @handleFormSubmit="handleFormSubmit" />
      </div>
    </div>
    <div class="home-row">
      <div class="row-width card-container">
        <line-chart
          :data="this.LineChartData"
          containerClass="custom-chart-container"
          :shadow="false"
        />
      </div>
      <div class="row-width card-container">
        <div>
          <button class="show-all-logs-button" @click="showAllLogs">
            Show All Logs
          </button>
        </div>
        <card title="Logs">
          <div class="custom-scrollbar">
            <log-list :logs="this.logs" />
          </div>
        </card>
      </div>
    </div>
  </div>
</template>

<script>
// @ is an alias to /src
import DoughnutChart from "@/components/charts/Doughnut.vue";
import LineChart from "@/components/charts/Line.vue";
import LogList from "@/components/listing/LogList.vue";
import Form from "@/components/formscomponent/FormContainer.vue";
import { makeApiRequest } from "@/store/requests";

export default {
  name: "HomeView",
  components: {
    "form-container": Form,
    "doughnut-chart": DoughnutChart,
    "line-chart": LineChart,
    "log-list": LogList,
  },
  mounted() {
    makeApiRequest("POST", "doughnut_chart_data/")
      .then((data) => {
        this.doughnutChartData = data.doughnutChartData;
      })
      .catch((error) => {
        console.error(error);
      });
    makeApiRequest("POST", "line_chart_data/")
      .then((data) => {
        this.LineChartData = data.LineChartData;
      })
      .catch((error) => {
        console.error(error);
      });
    makeApiRequest("POST", "get_logs/", { log_count: 0 })
      .then((data) => {
        this.logs = data.logs;
      })
      .catch((error) => {
        console.error(error);
      });
  },
  data() {
    return {
      componentKey: 0,
      // Sample chart data
      doughnutChartData: {
        labels: ["Label 1", "Label 2", "Label 3"],
        datasets: [
          {
            data: [30, 40, 30],
            backgroundColor: ["#ff6384", "#36a2eb", "#ffce56"],
            hoverBackgroundColor: ["#ff6384", "#36a2eb", "#ffce56"],
          },
        ],
      },
      LineChartData: {
        labels: ["January", "February", "March", "April", "May"],
        datasets: [
          {
            label: "Sample Data",
            data: [60, 65, 55, 70, 65],
            backgroundColor: "rgba(75, 192, 192, 0.2)",
            borderColor: "rgba(75, 192, 192, 1)",
            borderWidth: 1,
          },
        ],
      },
      logs: [
        {
          type: "inputType",
          data: "inputData",
          time: "14:12",
          color: "border-theme-1",
          key: 0,
          code: "code",
        },
      ],
    };
  },
  methods: {
    showAllLogs() {
      this.$router.push("/logs");
    },
    checkInputType(formdata) {
      const input = (formdata.inputdata || "").trim();
      console.log("formdata", formdata.inputdata, input);
      const urlRegex = /^(ftp|http|https):\/\/[^ "]+$/;
      const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
      const hostnameRegex = /^[a-zA-Z0-9.-]+$/;

      if (urlRegex.test(input)) {
        return "url";
      } else if (ipRegex.test(input)) {
        return "ip";
      } else if (hostnameRegex.test(input)) {
        return "host";
      } else {
        return null;
      }
    },
    handleFormSubmit(formData) {
      let inputType = this.checkInputType(formData);
      var payload = { inputType: inputType, inputData: formData.inputdata };
      makeApiRequest("POST", "otx-lookup/", payload)
        .then((data) => {
          console.log(data);
        })
        .catch((error) => {
          console.error(error);
        })
        .then(() => {
          makeApiRequest("POST", "get_logs/", { log_count: 0 })
            .then((response) => {
              this.logs = response.logs;
              makeApiRequest("POST", "line_chart_data/")
                .then((response) => {
                  this.LineChartData = response.LineChartData;
                  makeApiRequest("POST", "doughnut_chart_data/")
                    .then((response) => {
                      this.doughnutChartData = response.doughnutChartData;
                    })
                    .catch((error) => {
                      console.error(error);
                    });
                })
                .catch((error) => {
                  console.error(error);
                });
            })
            .catch((error) => {
              console.error(error);
            });
        });
    },
  },
};
</script>

<style scoped>
/* Add any custom styles for the Main component here */
.form-container {
  margin: auto;
  padding: 32px 24px;
  gap: 20px;
}
.card-container {
  margin: 10px;
  padding: 12px;
  background-color: #fff;
  font-size: 16px;
  font-family: "Arial", sans-serif;
  color: #333;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
  border-radius: 6px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  transition: box-shadow 0.3s ease-in-out;
}

.card-container:hover {
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}
.show-all-logs-button {
  background-color: #3498db;
  color: #ffffff;
  border: 1px solid #3498db;
  padding: 8px 12px;
  cursor: pointer;
  border-radius: 4px;
  margin-bottom: 10px;
}

.show-all-logs-button:hover {
  background-color: #2980b9;
  border-color: #2980b9;
}
.custom-chart-container {
  border: 1px solid #ccc;
  padding: 20px;
  margin: 20px;
}
::webkit-scrollbar {
  width: 12px;
}

::webkit-scrollbar-thumb {
  background-color: #6c757d; /* Bootstrap's gray color */
  border-radius: 10px;
}

::webkit-scrollbar-track {
  background-color: #e9ecef; /* Bootstrap's light gray color */
}
.custom-scrollbar {
  overflow-y: auto;
  max-height: 200px; /* Set a maximum height or customize as needed */
}
.home-column {
  display: flex;
  flex-direction: column;
}
.home-row {
  display: flex;
  flex-direction: row;
}
.row-width {
  width: 50%;
  height: 50%;
}
</style>
